# キャンパス時報システム 要件定義書 (Requirements Definition Document)

**プロジェクト名:** Campus Evening Chime System  
**バージョン:** 1.2.0 (平日稼働・アナウンス機能搭載版)  
**対象ハードウェア:** Raspberry Pi 3 Model B (Headless)  
**作成日:** 2025/11/30

---

## 1. プロジェクト概要

大学施設において、**平日（月〜金）の定刻（16:57）**に、合成音声によるアナウンスと「蛍の光」を自動再生し、学生・職員へ帰宅および閉館準備を促すシステムを構築する。

## 2. システム構成範囲

### 2.1 ハードウェア構成

- **ホスト:** Raspberry Pi 3 Model B
- **OS:** Raspberry Pi OS (Lite 推奨 / Headless 運用)
- **オーディオ:** USB スピーカー または 3.5mm ジャック接続スピーカー

### 2.2 ソフトウェア環境

- **言語:** Python 3.9 以上
- **デプロイ:** Git / GitHub

## 3. 機能要件 (Functional Requirements)

### 3.1 スケジューリング機能

- **トリガー時刻:** 毎日 16:57:00 (JST)
- **稼働日制限:** 月曜日から金曜日（平日）のみ稼働すること。土曜日・日曜日（祝日含む）は再生処理を行わない。
- **二重再生防止:** 同一日付内で 1 回のみ再生するロジックを実装すること。

### 3.2 音声再生機能 (Sequential Playback)

以下の順序で、途切れなく再生を行うこと。

1. **アナウンス再生 (Pre-Roll)**

   - **音源:** `assets/announce.wav` (VOICEVOX:ずんだもん)
   - **処理:** フェード処理なし、即時再生。
   - **完了待機:** アナウンスが完全に終了するまで次の処理を待機する。

2. **楽曲再生 (Main Content)**
   - **音源:** `assets/hotaru.mp3` (Auld Lang Syne)
   - **処理:** 再生開始時に 2000ms (2 秒) かけてフェードイン再生を行う。

### 3.4 環境自動判定機能 (Cross-Platform)

- **要件:** 実行環境（Linux 実機 / WSL 開発環境）を自動判定する。
- **WSL 挙動:** 音声出力およびプロセスキルを行わず、標準出力へのログ表示と `time.sleep` による時間経過シミュレーションのみを行う (Mock Mode)。

## 4. 運用・コンプライアンス要件 (Non-Functional)

### 4.1 著作権・ライセンス規定

- **楽曲:** パブリックドメインまたは著作権フリー音源を使用すること。
- **合成音声 (VOICEVOX):**
  - 音声ファイルはクレジット対応済みのものを使用する前提とする。

### 4.2 システム信頼性

- **自動復旧:** systemd により、電源投入後に自動的にサービスが開始されること。
- **負荷対策:** 待機ループ中の CPU 使用率を 1%未満に抑える設計とすること（適切な sleep の挿入）。
